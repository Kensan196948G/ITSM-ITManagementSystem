# データ構造定義書
## YAML仕様とJSON Schema定義

### 目次
1. [概要](#1-概要)
2. [共通データ構造](#2-共通データ構造)
3. [インシデント管理](#3-インシデント管理)
4. [問題管理](#4-問題管理)
5. [変更管理](#5-変更管理)
6. [CMDB](#6-cmdb)
7. [ユーザー管理](#7-ユーザー管理)
8. [ワークフロー](#8-ワークフロー)
9. [レポート](#9-レポート)
10. [設定管理](#10-設定管理)

---

## 1. 概要

### 1.1 データ構造設計原則
```yaml
Design_Principles:
  Consistency: "全モジュール共通の命名規則とフォーマット"
  Validation: "JSON Schema による厳密な検証"
  Extensibility: "将来の機能拡張に対応した柔軟な構造"
  Internationalization: "多言語対応のためのi18n対応"
  Audit_Trail: "完全な監査証跡のサポート"
  
Naming_Conventions:
  Fields: "snake_case"
  Constants: "UPPER_SNAKE_CASE"
  Classes: "PascalCase"
  Functions: "camelCase (Frontend), snake_case (Backend)"
  
Data_Types:
  UUID: "RFC 4122 準拠の UUID v4"
  DateTime: "ISO 8601 format with timezone"
  Email: "RFC 5322 準拠"
  URL: "RFC 3986 準拠"
```

### 1.2 共通フィールド定義
```yaml
# 共通フィールド仕様
Common_Fields:
  id:
    type: "string"
    format: "uuid"
    description: "一意識別子"
    example: "550e8400-e29b-41d4-a716-446655440000"
    
  tenant_id:
    type: "string"
    format: "uuid"
    description: "テナント識別子"
    required: true
    index: true
    
  created_at:
    type: "string"
    format: "date-time"
    description: "作成日時 (ISO 8601)"
    example: "2024-01-15T09:30:00+09:00"
    readonly: true
    
  updated_at:
    type: "string"
    format: "date-time"
    description: "更新日時 (ISO 8601)"
    example: "2024-01-15T10:15:00+09:00"
    readonly: true
    
  deleted_at:
    type: "string"
    format: "date-time"
    description: "削除日時 (論理削除)"
    nullable: true
    
  created_by:
    type: "string"
    format: "uuid"
    description: "作成者ID"
    readonly: true
    
  updated_by:
    type: "string"
    format: "uuid"
    description: "更新者ID"
    readonly: true
```

---

## 2. 共通データ構造

### 2.1 JSON Schema 共通定義
```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "definitions": {
    "BaseEntity": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "一意識別子"
        },
        "tenant_id": {
          "type": "string",
          "format": "uuid",
          "description": "テナント識別子"
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "作成日時"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time",
          "description": "更新日時"
        },
        "deleted_at": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "削除日時"
        },
        "created_by": {
          "type": "string",
          "format": "uuid",
          "description": "作成者ID"
        },
        "updated_by": {
          "type": "string",
          "format": "uuid",
          "description": "更新者ID"
        }
      },
      "required": ["id", "tenant_id", "created_at", "updated_at", "created_by"]
    },
    
    "PaginationMeta": {
      "type": "object",
      "properties": {
        "current_page": {
          "type": "integer",
          "minimum": 1,
          "description": "現在のページ番号"
        },
        "total_pages": {
          "type": "integer",
          "minimum": 0,
          "description": "総ページ数"
        },
        "total_count": {
          "type": "integer",
          "minimum": 0,
          "description": "総件数"
        },
        "per_page": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "description": "1ページあたりの件数"
        }
      },
      "required": ["current_page", "total_pages", "total_count", "per_page"]
    },
    
    "PaginationLinks": {
      "type": "object",
      "properties": {
        "first": {
          "type": ["string", "null"],
          "format": "uri",
          "description": "最初のページへのリンク"
        },
        "prev": {
          "type": ["string", "null"],
          "format": "uri",
          "description": "前のページへのリンク"
        },
        "next": {
          "type": ["string", "null"],
          "format": "uri",
          "description": "次のページへのリンク"
        },
        "last": {
          "type": ["string", "null"],
          "format": "uri",
          "description": "最後のページへのリンク"
        }
      }
    },
    
    "ErrorResponse": {
      "type": "object",
      "properties": {
        "error": {
          "type": "object",
          "properties": {
            "code": {
              "type": "string",
              "description": "エラーコード"
            },
            "message": {
              "type": "string",
              "description": "エラーメッセージ"
            },
            "details": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "field": {
                    "type": "string",
                    "description": "エラーフィールド"
                  },
                  "message": {
                    "type": "string",
                    "description": "フィールド固有のエラーメッセージ"
                  }
                },
                "required": ["field", "message"]
              }
            },
            "request_id": {
              "type": "string",
              "format": "uuid",
              "description": "リクエスト識別子"
            }
          },
          "required": ["code", "message"]
        }
      },
      "required": ["error"]
    }
  }
}
```

### 2.2 YAML設定ファイル構造
```yaml
# config/application.yml
Application:
  name: "ITSM Management System"
  version: "1.0.0"
  environment: "production|staging|development"
  
  Database:
    primary:
      host: "${DB_HOST}"
      port: "${DB_PORT:5432}"
      database: "${DB_NAME}"
      username: "${DB_USER}"
      password: "${DB_PASSWORD}"
      pool_size: "${DB_POOL_SIZE:10}"
      ssl_mode: "${DB_SSL_MODE:require}"
    
    cache:
      host: "${REDIS_HOST}"
      port: "${REDIS_PORT:6379}"
      database: "${REDIS_DB:0}"
      password: "${REDIS_PASSWORD}"
      
  Security:
    jwt:
      secret_key: "${JWT_SECRET_KEY}"
      algorithm: "RS256"
      access_token_expire_minutes: 60
      refresh_token_expire_days: 30
    
    cors:
      allowed_origins:
        - "https://app.itsm-system.com"
        - "https://staging.itsm-system.com"
      allowed_methods: ["GET", "POST", "PUT", "PATCH", "DELETE", "OPTIONS"]
      allowed_headers: ["*"]
      
  Features:
    incident_management: true
    problem_management: true
    change_management: true
    cmdb: true
    knowledge_base: true
    reporting: true
    
  Integrations:
    email:
      provider: "smtp|sendgrid|ses"
      settings:
        host: "${EMAIL_HOST}"
        port: "${EMAIL_PORT:587}"
        username: "${EMAIL_USER}"
        password: "${EMAIL_PASSWORD}"
        use_tls: true
    
    monitoring:
      prometheus:
        enabled: true
        endpoint: "/metrics"
      
      jaeger:
        enabled: true
        endpoint: "${JAEGER_ENDPOINT}"
```

---

## 3. インシデント管理

### 3.1 インシデントYAML定義
```yaml
# schema/incident.yml
Incident:
  type: "object"
  description: "インシデント情報"
  
  properties:
    # 基本情報
    incident_number:
      type: "string"
      pattern: "^INC\\d{6}$"
      description: "インシデント番号"
      example: "INC000123"
      unique: true
      
    title:
      type: "string"
      minLength: 5
      maxLength: 200
      description: "インシデントタイトル"
      example: "メールサーバー接続エラー"
      
    description:
      type: "string"
      maxLength: 10000
      description: "詳細説明"
      example: "朝9時頃からメールの送受信ができない状態です"
      
    # ステータス管理
    status:
      type: "string"
      enum: ["new", "assigned", "in_progress", "resolved", "closed"]
      description: "インシデントステータス"
      default: "new"
      
    priority:
      type: "string"
      enum: ["low", "medium", "high", "critical"]
      description: "優先度"
      
    impact:
      type: "string"
      enum: ["low", "medium", "high"]
      description: "影響度"
      
    urgency:
      type: "string"
      enum: ["low", "medium", "high"]
      description: "緊急度"
      
    # 関係者
    reporter_id:
      type: "string"
      format: "uuid"
      description: "報告者ID"
      
    assignee_id:
      type: "string"
      format: "uuid"
      description: "担当者ID"
      nullable: true
      
    team_id:
      type: "string"
      format: "uuid"
      description: "担当チームID"
      nullable: true
      
    # カテゴリ・分類
    category_id:
      type: "string"
      format: "uuid"
      description: "カテゴリID"
      nullable: true
      
    subcategory_id:
      type: "string"
      format: "uuid"
      description: "サブカテゴリID"
      nullable: true
      
    # SLA管理
    response_due_at:
      type: "string"
      format: "date-time"
      description: "応答期限"
      
    resolution_due_at:
      type: "string"
      format: "date-time"
      description: "解決期限"
      
    responded_at:
      type: "string"
      format: "date-time"
      description: "応答日時"
      nullable: true
      
    resolved_at:
      type: "string"
      format: "date-time"
      description: "解決日時"
      nullable: true
      
    closed_at:
      type: "string"
      format: "date-time"
      description: "完了日時"
      nullable: true
      
    # 解決情報
    resolution:
      type: "string"
      maxLength: 5000
      description: "解決内容"
      nullable: true
      
    # 関連情報
    affected_ci_ids:
      type: "array"
      items:
        type: "string"
        format: "uuid"
      description: "影響を受けるCI ID"
      
    related_incident_ids:
      type: "array"
      items:
        type: "string"
        format: "uuid"
      description: "関連インシデントID"
      
  required:
    - "incident_number"
    - "title"
    - "status"
    - "priority"
    - "reporter_id"
    - "response_due_at"
    - "resolution_due_at"

# インシデント作成リクエスト
IncidentCreateRequest:
  type: "object"
  properties:
    title:
      type: "string"
      minLength: 5
      maxLength: 200
      
    description:
      type: "string"
      maxLength: 10000
      
    priority:
      type: "string"
      enum: ["low", "medium", "high", "critical"]
      
    impact:
      type: "string"
      enum: ["low", "medium", "high"]
      
    urgency:
      type: "string"
      enum: ["low", "medium", "high"]
      
    category_id:
      type: "string"
      format: "uuid"
      nullable: true
      
    affected_ci_ids:
      type: "array"
      items:
        type: "string"
        format: "uuid"
      default: []
      
    attachments:
      type: "array"
      items:
        $ref: "#/definitions/AttachmentUpload"
      default: []
      
  required: ["title", "priority"]
```

### 3.2 インシデントJSON Schema
```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Incident",
  "type": "object",
  "allOf": [
    { "$ref": "#/definitions/BaseEntity" }
  ],
  "properties": {
    "incident_number": {
      "type": "string",
      "pattern": "^INC\\d{6}$",
      "description": "インシデント番号"
    },
    "title": {
      "type": "string",
      "minLength": 5,
      "maxLength": 200,
      "description": "タイトル"
    },
    "description": {
      "type": ["string", "null"],
      "maxLength": 10000,
      "description": "詳細説明"
    },
    "status": {
      "type": "string",
      "enum": ["new", "assigned", "in_progress", "resolved", "closed"],
      "description": "ステータス"
    },
    "priority": {
      "type": "string",
      "enum": ["low", "medium", "high", "critical"],
      "description": "優先度"
    },
    "impact": {
      "type": "string",
      "enum": ["low", "medium", "high"],
      "description": "影響度"
    },
    "urgency": {
      "type": "string",
      "enum": ["low", "medium", "high"],
      "description": "緊急度"
    },
    "reporter": {
      "$ref": "#/definitions/UserSummary"
    },
    "assignee": {
      "oneOf": [
        { "$ref": "#/definitions/UserSummary" },
        { "type": "null" }
      ]
    },
    "team": {
      "oneOf": [
        { "$ref": "#/definitions/TeamSummary" },
        { "type": "null" }
      ]
    },
    "category": {
      "oneOf": [
        { "$ref": "#/definitions/CategorySummary" },
        { "type": "null" }
      ]
    },
    "sla": {
      "$ref": "#/definitions/SLAInfo"
    },
    "work_notes": {
      "type": "array",
      "items": { "$ref": "#/definitions/WorkNote" }
    },
    "attachments": {
      "type": "array",
      "items": { "$ref": "#/definitions/Attachment" }
    },
    "history": {
      "type": "array",
      "items": { "$ref": "#/definitions/HistoryEntry" }
    }
  },
  "required": [
    "incident_number", "title", "status", "priority", 
    "impact", "urgency", "reporter"
  ]
}
```

### 3.3 関連データ構造
```yaml
# Work Note (作業メモ)
WorkNote:
  type: "object"
  properties:
    id:
      type: "string"
      format: "uuid"
      
    incident_id:
      type: "string"
      format: "uuid"
      
    note_type:
      type: "string"
      enum: ["work_note", "resolution_note", "customer_note"]
      
    content:
      type: "string"
      maxLength: 5000
      
    is_public:
      type: "boolean"
      default: false
      description: "顧客に表示するかどうか"
      
    author:
      $ref: "#/definitions/UserSummary"
      
  required: ["incident_id", "note_type", "content"]

# 添付ファイル
Attachment:
  type: "object"
  properties:
    id:
      type: "string"
      format: "uuid"
      
    incident_id:
      type: "string"
      format: "uuid"
      
    file_name:
      type: "string"
      maxLength: 255
      
    file_size:
      type: "integer"
      minimum: 0
      maximum: 52428800  # 50MB
      
    content_type:
      type: "string"
      pattern: "^[a-zA-Z0-9][a-zA-Z0-9!#$&\\-\\^_]*\/[a-zA-Z0-9][a-zA-Z0-9!#$&\\-\\^_]*$"
      
    storage_path:
      type: "string"
      description: "ストレージ内のファイルパス"
      
    uploaded_by:
      $ref: "#/definitions/UserSummary"
      
  required: ["incident_id", "file_name", "file_size", "content_type", "storage_path"]

# SLA情報
SLAInfo:
  type: "object"
  properties:
    response_due:
      type: "string"
      format: "date-time"
      description: "応答期限"
      
    resolution_due:
      type: "string"
      format: "date-time"
      description: "解決期限"
      
    response_met:
      type: "boolean"
      description: "応答期限内に対応したか"
      
    resolution_met:
      type: ["boolean", "null"]
      description: "解決期限内に解決したか"
      
    time_to_response:
      type: ["integer", "null"]
      description: "応答までの時間（秒）"
      
    time_to_resolution:
      type: ["integer", "null"]
      description: "解決までの時間（秒）"
      
  required: ["response_due", "resolution_due", "response_met"]
```

---

## 4. 問題管理

### 4.1 問題YAML定義
```yaml
# schema/problem.yml
Problem:
  type: "object"
  description: "問題情報"
  
  properties:
    problem_number:
      type: "string"
      pattern: "^PRB\\d{6}$"
      description: "問題番号"
      example: "PRB000001"
      unique: true
      
    title:
      type: "string"
      minLength: 5
      maxLength: 200
      description: "問題タイトル"
      
    description:
      type: "string"
      maxLength: 10000
      description: "問題の詳細説明"
      
    status:
      type: "string"
      enum: ["new", "assigned", "under_investigation", "root_cause_identified", "resolved", "closed"]
      description: "問題ステータス"
      
    priority:
      type: "string"
      enum: ["low", "medium", "high", "critical"]
      description: "優先度"
      
    # 根本原因分析
    impact_analysis:
      type: "string"
      maxLength: 5000
      description: "影響分析"
      nullable: true
      
    root_cause:
      type: "string"
      maxLength: 5000
      description: "根本原因"
      nullable: true
      
    rca_method:
      type: "string"
      enum: ["5why", "fishbone", "fault_tree", "other"]
      description: "根本原因分析手法"
      nullable: true
      
    rca_details:
      type: "object"
      description: "RCA詳細情報（手法に応じた構造化データ）"
      nullable: true
      
    # 解決策
    permanent_solution:
      type: "string"
      maxLength: 5000
      description: "恒久的解決策"
      nullable: true
      
    workaround:
      type: "string"
      maxLength: 5000
      description: "回避策"
      nullable: true
      
    # 関係者
    assignee_id:
      type: "string"
      format: "uuid"
      description: "担当者ID"
      nullable: true
      
    # 関連情報
    related_incident_ids:
      type: "array"
      items:
        type: "string"
        format: "uuid"
      description: "関連インシデントID"
      
    related_change_ids:
      type: "array"
      items:
        type: "string"
        format: "uuid"
      description: "関連変更ID"
      
    affected_ci_ids:
      type: "array"
      items:
        type: "string"
        format: "uuid"
      description: "影響を受けるCI ID"
      
  required: ["problem_number", "title", "status", "priority"]

# 既知エラー
KnownError:
  type: "object"
  properties:
    id:
      type: "string"
      format: "uuid"
      
    problem_id:
      type: "string"
      format: "uuid"
      description: "関連する問題ID"
      
    title:
      type: "string"
      maxLength: 200
      description: "既知エラータイトル"
      
    symptoms:
      type: "string"
      maxLength: 5000
      description: "症状"
      
    root_cause:
      type: "string"
      maxLength: 5000
      description: "根本原因"
      
    workaround:
      type: "string"
      maxLength: 5000
      description: "回避策"
      nullable: true
      
    solution:
      type: "string"
      maxLength: 5000
      description: "解決策"
      nullable: true
      
    is_published:
      type: "boolean"
      default: false
      description: "ナレッジベースに公開するか"
      
    usage_count:
      type: "integer"
      minimum: 0
      default: 0
      description: "参照回数"
      
  required: ["problem_id", "title", "symptoms", "root_cause"]
```

### 4.2 RCA詳細構造
```yaml
# 5Why分析
FiveWhyAnalysis:
  type: "object"
  properties:
    problem_statement:
      type: "string"
      description: "問題の定義"
      
    why_questions:
      type: "array"
      items:
        type: "object"
        properties:
          question:
            type: "string"
            description: "なぜ？の質問"
          answer:
            type: "string"
            description: "回答"
        required: ["question", "answer"]
      minItems: 1
      maxItems: 10
      
    root_cause_conclusion:
      type: "string"
      description: "根本原因の結論"
      
  required: ["problem_statement", "why_questions", "root_cause_conclusion"]

# フィッシュボーン分析
FishboneAnalysis:
  type: "object"
  properties:
    problem_statement:
      type: "string"
      description: "問題の定義"
      
    categories:
      type: "array"
      items:
        type: "object"
        properties:
          name:
            type: "string"
            enum: ["people", "process", "environment", "materials", "methods", "machines"]
          causes:
            type: "array"
            items:
              type: "object"
              properties:
                cause:
                  type: "string"
                sub_causes:
                  type: "array"
                  items:
                    type: "string"
              required: ["cause"]
        required: ["name", "causes"]
        
    primary_root_causes:
      type: "array"
      items:
        type: "string"
      description: "特定された主要根本原因"
      
  required: ["problem_statement", "categories"]
```

---

## 5. 変更管理

### 5.1 変更YAML定義
```yaml
# schema/change.yml
Change:
  type: "object"
  description: "変更情報"
  
  properties:
    change_number:
      type: "string"
      pattern: "^CHG\\d{6}$"
      description: "変更番号"
      example: "CHG000001"
      unique: true
      
    title:
      type: "string"
      minLength: 5
      maxLength: 200
      description: "変更タイトル"
      
    type:
      type: "string"
      enum: ["standard", "normal", "major", "emergency"]
      description: "変更タイプ"
      
    description:
      type: "string"
      maxLength: 10000
      description: "変更の詳細説明"
      
    justification:
      type: "string"
      maxLength: 5000
      description: "変更の正当性・理由"
      
    status:
      type: "string"
      enum: ["draft", "review", "approved", "scheduled", "in_progress", "implemented", "cancelled", "failed"]
      description: "変更ステータス"
      
    # リスク評価
    risk_level:
      type: "string"
      enum: ["low", "medium", "high", "very_high"]
      description: "リスクレベル"
      
    risk_assessment:
      type: "object"
      properties:
        impact:
          type: "string"
          enum: ["low", "medium", "high"]
        likelihood:
          type: "string"
          enum: ["low", "medium", "high"]
        mitigation_actions:
          type: "array"
          items:
            type: "string"
      required: ["impact", "likelihood"]
      
    # 実装計画
    implementation_plan:
      type: "string"
      maxLength: 10000
      description: "実装計画"
      
    rollback_plan:
      type: "string"
      maxLength: 10000
      description: "ロールバック計画"
      
    test_plan:
      type: "string"
      maxLength: 10000
      description: "テスト計画"
      nullable: true
      
    # スケジュール
    scheduled_start:
      type: "string"
      format: "date-time"
      description: "開始予定日時"
      
    scheduled_end:
      type: "string"
      format: "date-time"
      description: "終了予定日時"
      
    actual_start:
      type: "string"
      format: "date-time"
      description: "実際の開始日時"
      nullable: true
      
    actual_end:
      type: "string"
      format: "date-time"
      description: "実際の終了日時"
      nullable: true
      
    # 関係者
    requester_id:
      type: "string"
      format: "uuid"
      description: "要求者ID"
      
    implementer_id:
      type: "string"
      format: "uuid"
      description: "実装者ID"
      nullable: true
      
    # CAB
    cab_required:
      type: "boolean"
      default: false
      description: "CAB承認が必要か"
      
    # 影響CI
    affected_ci_ids:
      type: "array"
      items:
        type: "string"
        format: "uuid"
      description: "影響を受けるCI ID"
      
  required: ["change_number", "title", "type", "status", "risk_level", "implementation_plan", "rollback_plan", "scheduled_start", "scheduled_end", "requester_id"]

# 変更承認
ChangeApproval:
  type: "object"
  properties:
    id:
      type: "string"
      format: "uuid"
      
    change_id:
      type: "string"
      format: "uuid"
      description: "変更ID"
      
    approver_id:
      type: "string"
      format: "uuid"
      description: "承認者ID"
      
    approval_step:
      type: "string"
      description: "承認ステップ名"
      
    decision:
      type: "string"
      enum: ["pending", "approved", "rejected", "conditional"]
      description: "承認判定"
      
    comments:
      type: "string"
      maxLength: 5000
      description: "承認コメント"
      nullable: true
      
    conditions:
      type: "array"
      items:
        type: "string"
      description: "条件付き承認の条件"
      
    decided_at:
      type: "string"
      format: "date-time"
      description: "判定日時"
      nullable: true
      
    approval_order:
      type: "integer"
      minimum: 1
      description: "承認順序"
      
  required: ["change_id", "approver_id", "approval_step", "decision", "approval_order"]

# 変更タスク
ChangeTask:
  type: "object"
  properties:
    id:
      type: "string"
      format: "uuid"
      
    change_id:
      type: "string"
      format: "uuid"
      description: "変更ID"
      
    title:
      type: "string"
      maxLength: 200
      description: "タスクタイトル"
      
    description:
      type: "string"
      maxLength: 5000
      description: "タスク説明"
      nullable: true
      
    assignee_id:
      type: "string"
      format: "uuid"
      description: "担当者ID"
      
    status:
      type: "string"
      enum: ["pending", "in_progress", "completed", "failed", "skipped"]
      description: "タスクステータス"
      
    order:
      type: "integer"
      minimum: 1
      description: "実行順序"
      
    scheduled_start:
      type: "string"
      format: "date-time"
      description: "開始予定日時"
      
    scheduled_end:
      type: "string"
      format: "date-time"
      description: "終了予定日時"
      
    actual_start:
      type: "string"
      format: "date-time"
      description: "実際の開始日時"
      nullable: true
      
    actual_end:
      type: "string"
      format: "date-time"
      description: "実際の終了日時"
      nullable: true
      
  required: ["change_id", "title", "assignee_id", "status", "order", "scheduled_start", "scheduled_end"]
```

---

## 6. CMDB

### 6.1 構成アイテムYAML定義
```yaml
# schema/cmdb.yml
ConfigurationItem:
  type: "object"
  description: "構成アイテム"
  
  properties:
    ci_number:
      type: "string"
      pattern: "^CI\\d{6}$"
      description: "CI番号"
      example: "CI000001"
      unique: true
      
    name:
      type: "string"
      maxLength: 100
      description: "CI名"
      
    ci_type_id:
      type: "string"
      format: "uuid"
      description: "CIタイプID"
      
    status:
      type: "string"
      enum: ["active", "inactive", "retired", "maintenance", "unknown"]
      description: "ステータス"
      
    # 管理情報
    owner_id:
      type: "string"
      format: "uuid"
      description: "所有者ID"
      nullable: true
      
    custodian_id:
      type: "string"
      format: "uuid"
      description: "管理者ID"
      nullable: true
      
    location:
      type: "string"
      maxLength: 200
      description: "設置場所"
      nullable: true
      
    # 資産情報
    manufacturer:
      type: "string"
      maxLength: 100
      description: "製造元"
      nullable: true
      
    model:
      type: "string"
      maxLength: 100
      description: "モデル"
      nullable: true
      
    serial_number:
      type: "string"
      maxLength: 100
      description: "シリアル番号"
      nullable: true
      
    asset_tag:
      type: "string"
      maxLength: 50
      description: "資産タグ"
      nullable: true
      
    # 購入情報
    purchased_at:
      type: "string"
      format: "date"
      description: "購入日"
      nullable: true
      
    purchase_cost:
      type: "number"
      minimum: 0
      description: "購入価格"
      nullable: true
      
    warranty_expires_at:
      type: "string"
      format: "date"
      description: "保証期限"
      nullable: true
      
    # カスタム属性
    attributes:
      type: "object"
      description: "カスタム属性（CIタイプに応じた動的フィールド）"
      
  required: ["ci_number", "name", "ci_type_id", "status"]

# CIタイプ
CIType:
  type: "object"
  properties:
    id:
      type: "string"
      format: "uuid"
      
    name:
      type: "string"
      maxLength: 100
      description: "CIタイプ名"
      
    description:
      type: "string"
      maxLength: 500
      description: "説明"
      nullable: true
      
    category:
      type: "string"
      enum: ["hardware", "software", "service", "location", "person", "document", "other"]
      description: "カテゴリ"
      
    icon:
      type: "string"
      maxLength: 50
      description: "アイコン名"
      nullable: true
      
    # 属性定義
    attribute_schema:
      type: "object"
      description: "このCIタイプのカスタム属性スキーマ"
      properties:
        properties:
          type: "object"
          additionalProperties:
            type: "object"
            properties:
              type:
                type: "string"
                enum: ["string", "number", "boolean", "date", "select"]
              label:
                type: "string"
              required:
                type: "boolean"
              options:
                type: "array"
                items:
                  type: "string"
        required:
          type: "array"
          items:
            type: "string"
            
    is_active:
      type: "boolean"
      default: true
      description: "有効フラグ"
      
  required: ["name", "category"]

# CI関係性
CIRelationship:
  type: "object"
  properties:
    id:
      type: "string"
      format: "uuid"
      
    source_ci_id:
      type: "string"
      format: "uuid"
      description: "関係元CI ID"
      
    target_ci_id:
      type: "string"
      format: "uuid"
      description: "関係先CI ID"
      
    relationship_type:
      type: "string"
      enum: ["depends_on", "connects_to", "runs_on", "installed_on", "uses", "manages", "located_in", "member_of"]
      description: "関係タイプ"
      
    description:
      type: "string"
      maxLength: 500
      description: "関係の説明"
      nullable: true
      
    is_active:
      type: "boolean"
      default: true
      description: "有効フラグ"
      
  required: ["source_ci_id", "target_ci_id", "relationship_type"]
  
  # 制約: 自己参照禁止
  not:
    properties:
      source_ci_id:
        type: "string"
      target_ci_id:
        type: "string"
    required: ["source_ci_id", "target_ci_id"]
    propertyNames:
      enum: ["source_ci_id", "target_ci_id"]
    additionalProperties: false
    oneOf:
      - not:
          properties:
            source_ci_id:
              const:
                $data: "1/target_ci_id"
```

### 6.2 Discovery設定
```yaml
# Discovery設定
DiscoveryConfiguration:
  type: "object"
  properties:
    id:
      type: "string"
      format: "uuid"
      
    name:
      type: "string"
      maxLength: 100
      description: "Discovery設定名"
      
    type:
      type: "string"
      enum: ["network_scan", "agent_based", "cloud_api", "database_query", "file_system"]
      description: "Discoveryタイプ"
      
    target:
      type: "object"
      description: "ターゲット設定"
      properties:
        network_ranges:
          type: "array"
          items:
            type: "string"
            pattern: "^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\/\\d{1,2}$"
          description: "ネットワーク範囲（CIDR）"
          
        ports:
          type: "array"
          items:
            type: "integer"
            minimum: 1
            maximum: 65535
          description: "スキャン対象ポート"
          
        credentials:
          type: "object"
          properties:
            username:
              type: "string"
            password_secret_id:
              type: "string"
              description: "パスワードシークレットID"
            ssh_key_secret_id:
              type: "string"
              description: "SSH秘密鍵シークレットID"
          
    schedule:
      type: "object"
      properties:
        enabled:
          type: "boolean"
          default: false
          
        cron_expression:
          type: "string"
          pattern: "^(\\*|[0-5]?[0-9]|\\*\\/[0-9]+) (\\*|1?[0-9]|2[0-3]|\\*\\/[0-9]+) (\\*|[1-2]?[0-9]|3[0-1]|\\*\\/[0-9]+) (\\*|[1-9]|1[0-2]|\\*\\/[0-9]+) (\\*|[0-6]|\\*\\/[0-9]+)$"
          description: "Cron式（秒 分 時 日 月 曜日）"
          
        timezone:
          type: "string"
          default: "Asia/Tokyo"
          description: "タイムゾーン"
          
    mapping_rules:
      type: "array"
      items:
        type: "object"
        properties:
          condition:
            type: "object"
            description: "適用条件"
            
          ci_type_id:
            type: "string"
            format: "uuid"
            description: "マッピング先CIタイプ"
            
          attribute_mapping:
            type: "object"
            description: "属性マッピング定義"
            
        required: ["condition", "ci_type_id", "attribute_mapping"]
        
    is_active:
      type: "boolean"
      default: true
      
  required: ["name", "type", "target"]
```

---

## 7. ユーザー管理

### 7.1 ユーザーYAML定義
```yaml
# schema/user.yml
User:
  type: "object"
  description: "ユーザー情報"
  
  properties:
    employee_id:
      type: "string"
      maxLength: 50
      description: "社員番号"
      unique: true
      
    email:
      type: "string"
      format: "email"
      maxLength: 255
      description: "メールアドレス"
      unique: true
      
    username:
      type: "string"
      pattern: "^[a-zA-Z0-9._-]{3,50}$"
      description: "ユーザー名"
      unique: true
      
    # 基本情報
    first_name:
      type: "string"
      maxLength: 100
      description: "名"
      
    last_name:
      type: "string"
      maxLength: 100
      description: "姓"
      
    display_name:
      type: "string"
      maxLength: 200
      description: "表示名"
      nullable: true
      
    # 連絡先
    phone:
      type: "string"
      pattern: "^[+]?[0-9\\-\\(\\)\\s]{10,20}$"
      description: "電話番号"
      nullable: true
      
    mobile:
      type: "string"
      pattern: "^[+]?[0-9\\-\\(\\)\\s]{10,20}$"
      description: "携帯電話番号"
      nullable: true
      
    # 組織情報
    department:
      type: "string"
      maxLength: 100
      description: "部署"
      nullable: true
      
    job_title:
      type: "string"
      maxLength: 100
      description: "役職"
      nullable: true
      
    manager_id:
      type: "string"
      format: "uuid"
      description: "上司ID"
      nullable: true
      
    # 設定
    timezone:
      type: "string"
      maxLength: 50
      default: "Asia/Tokyo"
      description: "タイムゾーン"
      
    locale:
      type: "string"
      pattern: "^[a-z]{2}_[A-Z]{2}$"
      default: "ja_JP"
      description: "ロケール"
      
    # ステータス
    is_active:
      type: "boolean"
      default: true
      description: "有効フラグ"
      
    is_locked:
      type: "boolean"
      default: false
      description: "アカウントロック"
      
    # 認証情報
    last_login_at:
      type: "string"
      format: "date-time"
      description: "最終ログイン日時"
      nullable: true
      
    password_expires_at:
      type: "string"
      format: "date-time"
      description: "パスワード有効期限"
      nullable: true
      
    failed_login_count:
      type: "integer"
      minimum: 0
      default: 0
      description: "ログイン失敗回数"
      
    # MFA
    mfa_enabled:
      type: "boolean"
      default: false
      description: "多要素認証有効"
      
    mfa_secret:
      type: "string"
      description: "MFAシークレット"
      nullable: true
      writeOnly: true
      
  required: ["employee_id", "email", "username", "first_name", "last_name"]

# チーム
Team:
  type: "object"
  properties:
    id:
      type: "string"
      format: "uuid"
      
    name:
      type: "string"
      maxLength: 100
      description: "チーム名"
      
    description:
      type: "string"
      maxLength: 500
      description: "説明"
      nullable: true
      
    parent_team_id:
      type: "string"
      format: "uuid"
      description: "親チームID"
      nullable: true
      
    manager_id:
      type: "string"
      format: "uuid"
      description: "マネージャーID"
      nullable: true
      
    email:
      type: "string"
      format: "email"
      description: "チームメールアドレス"
      nullable: true
      
    is_active:
      type: "boolean"
      default: true
      description: "有効フラグ"
      
  required: ["name"]

# ロール
Role:
  type: "object"
  properties:
    id:
      type: "string"
      format: "uuid"
      
    name:
      type: "string"
      maxLength: 100
      description: "ロール名"
      
    description:
      type: "string"
      maxLength: 500
      description: "説明"
      nullable: true
      
    is_system:
      type: "boolean"
      default: false
      description: "システムロール（編集不可）"
      
    permissions:
      type: "array"
      items:
        type: "string"
      description: "権限リスト"
      
  required: ["name", "permissions"]

# 権限
Permission:
  type: "object"
  properties:
    id:
      type: "string"
      format: "uuid"
      
    resource:
      type: "string"
      maxLength: 100
      description: "リソース名"
      
    action:
      type: "string"
      maxLength: 50
      description: "アクション名"
      
    description:
      type: "string"
      maxLength: 500
      description: "説明"
      nullable: true
      
  required: ["resource", "action"]
  
  # 複合ユニーク制約
  uniqueItems: true
  unique: ["resource", "action"]
```

### 7.2 認証関連データ構造
```yaml
# 認証トークン
AuthToken:
  type: "object"
  properties:
    access_token:
      type: "string"
      description: "アクセストークン（JWT）"
      
    token_type:
      type: "string"
      enum: ["Bearer"]
      description: "トークンタイプ"
      
    expires_in:
      type: "integer"
      minimum: 1
      description: "有効期限（秒）"
      
    refresh_token:
      type: "string"
      description: "リフレッシュトークン"
      
    scope:
      type: "string"
      description: "権限スコープ"
      
  required: ["access_token", "token_type", "expires_in"]

# ログイン要求
LoginRequest:
  type: "object"
  properties:
    email:
      type: "string"
      format: "email"
      description: "メールアドレス"
      
    password:
      type: "string"
      minLength: 8
      description: "パスワード"
      
    totp_code:
      type: "string"
      pattern: "^[0-9]{6}$"
      description: "TOTP認証コード"
      nullable: true
      
    remember_me:
      type: "boolean"
      default: false
      description: "ログイン状態を記憶"
      
  required: ["email", "password"]

# パスワード変更要求
PasswordChangeRequest:
  type: "object"
  properties:
    current_password:
      type: "string"
      description: "現在のパスワード"
      
    new_password:
      type: "string"
      minLength: 8
      pattern: "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]"
      description: "新しいパスワード（大小英数字記号を含む8文字以上）"
      
    confirm_password:
      type: "string"
      description: "新しいパスワード（確認）"
      
  required: ["current_password", "new_password", "confirm_password"]
  
  # パスワード一致検証
  if:
    properties:
      new_password:
        type: "string"
      confirm_password:
        type: "string"
  then:
    properties:
      confirm_password:
        const:
          $data: "1/new_password"
```

---

## 8. ワークフロー

### 8.1 ワークフローYAML定義
```yaml
# schema/workflow.yml
Workflow:
  type: "object"
  description: "ワークフロー定義"
  
  properties:
    id:
      type: "string"
      format: "uuid"
      
    name:
      type: "string"
      maxLength: 200
      description: "ワークフロー名"
      
    description:
      type: "string"
      maxLength: 1000
      description: "説明"
      nullable: true
      
    workflow_type:
      type: "string"
      enum: ["incident", "problem", "change", "service_request", "approval", "custom"]
      description: "ワークフロータイプ"
      
    version:
      type: "string"
      pattern: "^\\d+\\.\\d+\\.\\d+$"
      description: "バージョン"
      
    is_active:
      type: "boolean"
      default: true
      description: "有効フラグ"
      
    # ワークフロー定義
    definition:
      type: "object"
      properties:
        start_step:
          type: "string"
          description: "開始ステップID"
          
        steps:
          type: "object"
          additionalProperties:
            $ref: "#/definitions/WorkflowStep"
          description: "ステップ定義"
          
        variables:
          type: "object"
          description: "ワークフロー変数定義"
          
        conditions:
          type: "object"
          description: "条件定義"
          
      required: ["start_step", "steps"]
      
  required: ["name", "workflow_type", "version", "definition"]

# ワークフローステップ
WorkflowStep:
  type: "object"
  properties:
    id:
      type: "string"
      description: "ステップID"
      
    name:
      type: "string"
      maxLength: 100
      description: "ステップ名"
      
    type:
      type: "string"
      enum: ["task", "approval", "notification", "condition", "parallel", "end"]
      description: "ステップタイプ"
      
    # タスク設定
    task_config:
      type: "object"
      properties:
        assignee_type:
          type: "string"
          enum: ["user", "team", "role", "expression"]
          
        assignee_value:
          type: "string"
          description: "割り当て先"
          
        due_days:
          type: "integer"
          minimum: 0
          description: "期限（日数）"
          
        auto_complete:
          type: "boolean"
          default: false
          description: "自動完了"
          
        form_fields:
          type: "array"
          items:
            $ref: "#/definitions/FormField"
          description: "フォームフィールド"
          
      nullable: true
      
    # 承認設定
    approval_config:
      type: "object"
      properties:
        approvers:
          type: "array"
          items:
            type: "object"
            properties:
              type:
                type: "string"
                enum: ["user", "team", "role"]
              value:
                type: "string"
              order:
                type: "integer"
            required: ["type", "value"]
            
        approval_type:
          type: "string"
          enum: ["all", "any", "majority"]
          default: "all"
          
        timeout_days:
          type: "integer"
          minimum: 1
          description: "承認期限（日数）"
          
      nullable: true
      
    # 通知設定
    notification_config:
      type: "object"
      properties:
        recipients:
          type: "array"
          items:
            type: "string"
          description: "受信者リスト"
          
        template:
          type: "string"
          description: "通知テンプレート"
          
        channels:
          type: "array"
          items:
            type: "string"
            enum: ["email", "sms", "slack", "teams", "webhook"]
          
      nullable: true
      
    # 次ステップ
    transitions:
      type: "array"
      items:
        type: "object"
        properties:
          to_step:
            type: "string"
            description: "遷移先ステップID"
            
          condition:
            type: "string"
            description: "遷移条件"
            nullable: true
            
          label:
            type: "string"
            description: "遷移ラベル"
            
        required: ["to_step"]
        
  required: ["id", "name", "type", "transitions"]

# ワークフローインスタンス
WorkflowInstance:
  type: "object"
  properties:
    id:
      type: "string"
      format: "uuid"
      
    workflow_id:
      type: "string"
      format: "uuid"
      description: "ワークフローID"
      
    entity_type:
      type: "string"
      enum: ["incident", "problem", "change", "service_request"]
      description: "対象エンティティタイプ"
      
    entity_id:
      type: "string"
      format: "uuid"
      description: "対象エンティティID"
      
    status:
      type: "string"
      enum: ["running", "completed", "failed", "cancelled", "suspended"]
      description: "実行ステータス"
      
    current_step:
      type: "string"
      description: "現在のステップID"
      nullable: true
      
    context:
      type: "object"
      description: "実行コンテキスト"
      
    started_at:
      type: "string"
      format: "date-time"
      description: "開始日時"
      
    completed_at:
      type: "string"
      format: "date-time"
      description: "完了日時"
      nullable: true
      
    # ステップ実行履歴
    step_executions:
      type: "array"
      items:
        $ref: "#/definitions/StepExecution"
      description: "ステップ実行履歴"
      
  required: ["workflow_id", "entity_type", "entity_id", "status", "started_at"]

# ステップ実行
StepExecution:
  type: "object"
  properties:
    id:
      type: "string"
      format: "uuid"
      
    workflow_instance_id:
      type: "string"
      format: "uuid"
      description: "ワークフローインスタンスID"
      
    step_id:
      type: "string"
      description: "ステップID"
      
    status:
      type: "string"
      enum: ["pending", "in_progress", "completed", "failed", "skipped"]
      description: "実行ステータス"
      
    assignee_id:
      type: "string"
      format: "uuid"
      description: "担当者ID"
      nullable: true
      
    started_at:
      type: "string"
      format: "date-time"
      description: "開始日時"
      nullable: true
      
    completed_at:
      type: "string"
      format: "date-time"
      description: "完了日時"
      nullable: true
      
    result:
      type: "object"
      description: "実行結果"
      nullable: true
      
    comments:
      type: "string"
      maxLength: 5000
      description: "コメント"
      nullable: true
      
  required: ["workflow_instance_id", "step_id", "status"]
```

### 8.2 フォームフィールド定義
```yaml
# フォームフィールド
FormField:
  type: "object"
  properties:
    name:
      type: "string"
      maxLength: 100
      description: "フィールド名"
      
    label:
      type: "string"
      maxLength: 200
      description: "表示ラベル"
      
    type:
      type: "string"
      enum: ["text", "textarea", "number", "date", "datetime", "select", "multiselect", "checkbox", "radio", "file"]
      description: "フィールドタイプ"
      
    required:
      type: "boolean"
      default: false
      description: "必須フラグ"
      
    validation:
      type: "object"
      properties:
        min_length:
          type: "integer"
          minimum: 0
        max_length:
          type: "integer"
          minimum: 1
        pattern:
          type: "string"
          description: "正規表現パターン"
        min_value:
          type: "number"
        max_value:
          type: "number"
      nullable: true
      
    options:
      type: "array"
      items:
        type: "object"
        properties:
          value:
            type: "string"
          label:
            type: "string"
        required: ["value", "label"]
      description: "選択肢（select, multiselect, radio用）"
      nullable: true
      
    default_value:
      description: "デフォルト値"
      nullable: true
      
    placeholder:
      type: "string"
      description: "プレースホルダー"
      nullable: true
      
    help_text:
      type: "string"
      description: "ヘルプテキスト"
      nullable: true
      
  required: ["name", "label", "type"]
```

---

## 9. レポート

### 9.1 レポートYAML定義
```yaml
# schema/report.yml
Report:
  type: "object"
  description: "レポート定義"
  
  properties:
    id:
      type: "string"
      format: "uuid"
      
    name:
      type: "string"
      maxLength: 200
      description: "レポート名"
      
    description:
      type: "string"
      maxLength: 1000
      description: "説明"
      nullable: true
      
    category:
      type: "string"
      enum: ["operational", "management", "compliance", "performance", "custom"]
      description: "レポートカテゴリ"
      
    type:
      type: "string"
      enum: ["dashboard", "chart", "table", "kpi", "export"]
      description: "レポートタイプ"
      
    # データソース設定
    data_source:
      type: "object"
      properties:
        query:
          type: "string"
          description: "SQLクエリまたはAPI呼び出し定義"
          
        parameters:
          type: "array"
          items:
            $ref: "#/definitions/ReportParameter"
          description: "パラメータ定義"
          
        refresh_interval:
          type: "integer"
          minimum: 0
          description: "リフレッシュ間隔（秒、0=手動）"
          
      required: ["query"]
      
    # 表示設定
    visualization:
      type: "object"
      properties:
        chart_type:
          type: "string"
          enum: ["line", "bar", "pie", "doughnut", "area", "scatter", "heatmap", "gauge", "table"]
          description: "チャートタイプ"
          
        x_axis:
          type: "string"
          description: "X軸フィールド"
          
        y_axis:
          type: "string"
          description: "Y軸フィールド"
          
        series:
          type: "array"
          items:
            type: "string"
          description: "系列フィールド"
          
        colors:
          type: "array"
          items:
            type: "string"
            pattern: "^#[0-9A-Fa-f]{6}$"
          description: "カラーパレット"
          
        options:
          type: "object"
          description: "チャート固有オプション"
          
      nullable: true
      
    # 権限設定
    permissions:
      type: "object"
      properties:
        viewers:
          type: "array"
          items:
            type: "object"
            properties:
              type:
                type: "string"
                enum: ["user", "team", "role"]
              value:
                type: "string"
            required: ["type", "value"]
          description: "閲覧権限"
          
        editors:
          type: "array"
          items:
            type: "object"
            properties:
              type:
                type: "string"
                enum: ["user", "team", "role"]
              value:
                type: "string"
            required: ["type", "value"]
          description: "編集権限"
          
      required: ["viewers"]
      
    # スケジュール設定
    schedule:
      type: "object"
      properties:
        enabled:
          type: "boolean"
          default: false
          
        cron_expression:
          type: "string"
          description: "Cron式"
          
        output_format:
          type: "string"
          enum: ["pdf", "excel", "csv", "json"]
          description: "出力フォーマット"
          
        recipients:
          type: "array"
          items:
            type: "string"
            format: "email"
          description: "送信先メールアドレス"
          
      nullable: true
      
    is_active:
      type: "boolean"
      default: true
      description: "有効フラグ"
      
  required: ["name", "category", "type", "data_source", "permissions"]

# レポートパラメータ
ReportParameter:
  type: "object"
  properties:
    name:
      type: "string"
      maxLength: 100
      description: "パラメータ名"
      
    label:
      type: "string"
      maxLength: 200
      description: "表示ラベル"
      
    type:
      type: "string"
      enum: ["string", "number", "date", "datetime", "select", "multiselect", "boolean"]
      description: "パラメータタイプ"
      
    required:
      type: "boolean"
      default: false
      description: "必須フラグ"
      
    default_value:
      description: "デフォルト値"
      nullable: true
      
    options:
      type: "array"
      items:
        type: "object"
        properties:
          value:
            description: "値"
          label:
            type: "string"
            description: "表示ラベル"
        required: ["value", "label"]
      description: "選択肢（select, multiselect用）"
      nullable: true
      
    validation:
      type: "object"
      properties:
        min_value:
          type: "number"
        max_value:
          type: "number"
        pattern:
          type: "string"
      nullable: true
      
  required: ["name", "label", "type"]

# ダッシュボード
Dashboard:
  type: "object"
  properties:
    id:
      type: "string"
      format: "uuid"
      
    name:
      type: "string"
      maxLength: 200
      description: "ダッシュボード名"
      
    description:
      type: "string"
      maxLength: 1000
      description: "説明"
      nullable: true
      
    layout:
      type: "object"
      properties:
        grid_size:
          type: "object"
          properties:
            columns:
              type: "integer"
              minimum: 1
              maximum: 24
              default: 12
            rows:
              type: "integer"
              minimum: 1
              default: 12
          required: ["columns", "rows"]
          
        widgets:
          type: "array"
          items:
            type: "object"
            properties:
              id:
                type: "string"
                format: "uuid"
              report_id:
                type: "string"
                format: "uuid"
              position:
                type: "object"
                properties:
                  x:
                    type: "integer"
                    minimum: 0
                  y:
                    type: "integer"
                    minimum: 0
                  width:
                    type: "integer"
                    minimum: 1
                  height:
                    type: "integer"
                    minimum: 1
                required: ["x", "y", "width", "height"]
              title:
                type: "string"
                maxLength: 100
                nullable: true
            required: ["id", "report_id", "position"]
            
      required: ["grid_size", "widgets"]
      
    permissions:
      type: "object"
      properties:
        viewers:
          type: "array"
          items:
            type: "object"
            properties:
              type:
                type: "string"
                enum: ["user", "team", "role"]
              value:
                type: "string"
            required: ["type", "value"]
            
      required: ["viewers"]
      
    is_default:
      type: "boolean"
      default: false
      description: "デフォルトダッシュボード"
      
    is_active:
      type: "boolean"
      default: true
      description: "有効フラグ"
      
  required: ["name", "layout", "permissions"]
```

---

## 10. 設定管理

### 10.1 システム設定YAML定義
```yaml
# schema/settings.yml
SystemSettings:
  type: "object"
  description: "システム設定"
  
  properties:
    # 基本設定
    general:
      type: "object"
      properties:
        system_name:
          type: "string"
          maxLength: 100
          default: "ITSM Management System"
          description: "システム名"
          
        timezone:
          type: "string"
          default: "Asia/Tokyo"
          description: "デフォルトタイムゾーン"
          
        locale:
          type: "string"
          pattern: "^[a-z]{2}_[A-Z]{2}$"
          default: "ja_JP"
          description: "デフォルトロケール"
          
        date_format:
          type: "string"
          enum: ["YYYY-MM-DD", "DD/MM/YYYY", "MM/DD/YYYY", "YYYY年MM月DD日"]
          default: "YYYY-MM-DD"
          description: "日付フォーマット"
          
        time_format:
          type: "string"
          enum: ["24h", "12h"]
          default: "24h"
          description: "時刻フォーマット"
          
        logo_url:
          type: "string"
          format: "uri"
          description: "ロゴURL"
          nullable: true
          
        maintenance_message:
          type: "string"
          maxLength: 1000
          description: "メンテナンスメッセージ"
          nullable: true
          
      required: ["system_name", "timezone", "locale"]
      
    # セキュリティ設定
    security:
      type: "object"
      properties:
        password_policy:
          type: "object"
          properties:
            min_length:
              type: "integer"
              minimum: 8
              maximum: 128
              default: 12
            require_uppercase:
              type: "boolean"
              default: true
            require_lowercase:
              type: "boolean"
              default: true
            require_numbers:
              type: "boolean"
              default: true
            require_symbols:
              type: "boolean"
              default: true
            max_age_days:
              type: "integer"
              minimum: 30
              maximum: 365
              default: 90
            history_count:
              type: "integer"
              minimum: 1
              maximum: 24
              default: 5
          required: ["min_length"]
          
        session_settings:
          type: "object"
          properties:
            timeout_minutes:
              type: "integer"
              minimum: 15
              maximum: 480
              default: 60
            max_concurrent_sessions:
              type: "integer"
              minimum: 1
              maximum: 10
              default: 3
            remember_me_days:
              type: "integer"
              minimum: 1
              maximum: 365
              default: 30
          required: ["timeout_minutes"]
          
        lockout_policy:
          type: "object"
          properties:
            max_attempts:
              type: "integer"
              minimum: 3
              maximum: 10
              default: 5
            lockout_duration_minutes:
              type: "integer"
              minimum: 5
              maximum: 1440
              default: 30
            reset_counter_minutes:
              type: "integer"
              minimum: 15
              maximum: 1440
              default: 60
          required: ["max_attempts", "lockout_duration_minutes"]
          
        mfa_settings:
          type: "object"
          properties:
            enabled:
              type: "boolean"
              default: true
            required_for_admin:
              type: "boolean"
              default: true
            methods:
              type: "array"
              items:
                type: "string"
                enum: ["totp", "sms", "email", "webauthn"]
              default: ["totp"]
            backup_codes_count:
              type: "integer"
              minimum: 5
              maximum: 20
              default: 10
          required: ["enabled", "methods"]
          
      required: ["password_policy", "session_settings", "lockout_policy"]
      
    # SLA設定
    sla:
      type: "object"
      properties:
        default_business_hours:
          type: "object"
          properties:
            start_time:
              type: "string"
              pattern: "^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
              default: "09:00"
            end_time:
              type: "string"
              pattern: "^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
              default: "18:00"
            working_days:
              type: "array"
              items:
                type: "integer"
                minimum: 1
                maximum: 7
              default: [1, 2, 3, 4, 5]  # 月-金
              description: "営業日（1=月曜日, 7=日曜日）"
          required: ["start_time", "end_time", "working_days"]
          
        priority_matrix:
          type: "object"
          additionalProperties:
            type: "object"
            properties:
              response_minutes:
                type: "integer"
                minimum: 5
              resolution_hours:
                type: "integer"
                minimum: 1
            required: ["response_minutes", "resolution_hours"]
          default:
            critical:
              response_minutes: 15
              resolution_hours: 4
            high:
              response_minutes: 60
              resolution_hours: 8
            medium:
              response_minutes: 240
              resolution_hours: 24
            low:
              response_minutes: 480
              resolution_hours: 72
              
        escalation_rules:
          type: "array"
          items:
            type: "object"
            properties:
              condition:
                type: "string"
                description: "エスカレーション条件"
              action:
                type: "string"
                enum: ["notify", "reassign", "priority_up"]
              target:
                type: "string"
                description: "エスカレーション先"
              delay_minutes:
                type: "integer"
                minimum: 5
            required: ["condition", "action", "target", "delay_minutes"]
            
      required: ["default_business_hours", "priority_matrix"]
      
    # 通知設定
    notifications:
      type: "object"
      properties:
        email_settings:
          type: "object"
          properties:
            enabled:
              type: "boolean"
              default: true
            from_address:
              type: "string"
              format: "email"
            from_name:
              type: "string"
              maxLength: 100
            reply_to:
              type: "string"
              format: "email"
              nullable: true
          required: ["enabled", "from_address", "from_name"]
          
        sms_settings:
          type: "object"
          properties:
            enabled:
              type: "boolean"
              default: false
            provider:
              type: "string"
              enum: ["twilio", "aws_sns", "custom"]
              nullable: true
          required: ["enabled"]
          
        webhook_settings:
          type: "object"
          properties:
            enabled:
              type: "boolean"
              default: true
            timeout_seconds:
              type: "integer"
              minimum: 5
              maximum: 60
              default: 30
            retry_count:
              type: "integer"
              minimum: 0
              maximum: 5
              default: 3
          required: ["enabled"]
          
        default_templates:
          type: "object"
          additionalProperties:
            type: "object"
            properties:
              subject:
                type: "string"
                maxLength: 200
              body:
                type: "string"
                maxLength: 10000
              variables:
                type: "array"
                items:
                  type: "string"
            required: ["subject", "body"]
            
      required: ["email_settings"]
      
    # 統合設定
    integrations:
      type: "object"
      properties:
        ldap:
          type: "object"
          properties:
            enabled:
              type: "boolean"
              default: false
            server:
              type: "string"
              nullable: true
            port:
              type: "integer"
              minimum: 1
              maximum: 65535
              default: 389
            use_ssl:
              type: "boolean"
              default: false
            base_dn:
              type: "string"
              nullable: true
            user_filter:
              type: "string"
              nullable: true
            sync_interval_hours:
              type: "integer"
              minimum: 1
              maximum: 168
              default: 24
          required: ["enabled"]
          
        monitoring:
          type: "object"
          properties:
            prometheus_enabled:
              type: "boolean"
              default: true
            jaeger_enabled:
              type: "boolean"
              default: true
            log_level:
              type: "string"
              enum: ["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"]
              default: "INFO"
          required: ["log_level"]
          
      required: ["monitoring"]
      
  required: ["general", "security", "sla", "notifications", "integrations"]

# テナント設定
TenantSettings:
  type: "object"
  description: "テナント固有設定"
  
  properties:
    tenant_id:
      type: "string"
      format: "uuid"
      
    # カスタマイズ設定
    customization:
      type: "object"
      properties:
        theme:
          type: "object"
          properties:
            primary_color:
              type: "string"
              pattern: "^#[0-9A-Fa-f]{6}$"
              default: "#1976D2"
            secondary_color:
              type: "string"
              pattern: "^#[0-9A-Fa-f]{6}$"
              default: "#DC004E"
            logo_url:
              type: "string"
              format: "uri"
              nullable: true
            favicon_url:
              type: "string"
              format: "uri"
              nullable: true
              
        branding:
          type: "object"
          properties:
            company_name:
              type: "string"
              maxLength: 100
            copyright_text:
              type: "string"
              maxLength: 200
              nullable: true
            support_email:
              type: "string"
              format: "email"
              nullable: true
            support_phone:
              type: "string"
              nullable: true
              
    # 機能設定
    features:
      type: "object"
      properties:
        incident_management:
          type: "boolean"
          default: true
        problem_management:
          type: "boolean"
          default: true
        change_management:
          type: "boolean"
          default: true
        cmdb:
          type: "boolean"
          default: true
        knowledge_base:
          type: "boolean"
          default: true
        reporting:
          type: "boolean"
          default: true
        api_access:
          type: "boolean"
          default: true
        mobile_app:
          type: "boolean"
          default: true
          
    # 制限設定
    limits:
      type: "object"
      properties:
        max_users:
          type: "integer"
          minimum: 1
          nullable: true
        max_incidents_per_month:
          type: "integer"
          minimum: 100
          nullable: true
        storage_limit_gb:
          type: "integer"
          minimum: 1
          nullable: true
        api_calls_per_day:
          type: "integer"
          minimum: 1000
          nullable: true
          
  required: ["tenant_id"]
```

---

## 結論

このデータ構造定義書により、以下が実現されます：

### 1. 統一性の確保
- 全モジュール共通の命名規則とデータ形式
- JSON Schema による厳密な検証
- 一貫したエラーハンドリング

### 2. 開発効率の向上
- 明確なデータ構造による迷いのない実装
- 自動コード生成の基盤
- API仕様との完全な整合性

### 3. 品質保証
- 入力値検証の自動化
- データ整合性の保証
- セキュリティ要件の組み込み

### 4. 保守性の向上
- 構造化された設定管理
- バージョン管理対応
- 拡張性を考慮した設計

### 5. 国際化対応
- 多言語対応の基盤
- タイムゾーン対応
- 地域固有の要件への対応

各エージェントは、これらのデータ構造定義に基づいて実装を進めることで、高品質で一貫性のあるシステムを構築できます。